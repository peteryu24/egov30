<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="gmx.fwd.mapper.log.LogMapper">


	<insert id="writeLog" parameterType="gmx.fwd.vo.logvo.LogVO">
		INSERT INTO
			exam.logs
				(category, email, activity)
		VALUES
			(#{category}, #{email}, #{activity})
	</insert>

	<select id="logsPerPage" parameterType="map"
		resultType="gmx.fwd.vo.logvo.LogVO">
		SELECT
			exam.logs.*
		FROM
			exam.logs
		WHERE
        	exam.logs.category LIKE CONCAT('%', #{category, jdbcType=VARCHAR}, '%')
		ORDER BY
			exam.logs.log_id 
			DESC
		LIMIT
			10
		OFFSET
			#{start}
	</select>

	<select id="getLogCount" resultType="int">
		SELECT
			count(*)
		FROM
			exam.logs
	</select>
	
	<select id="getLogCountByCategory" resultType="int">
		SELECT
			count(*)
		FROM
			exam.logs
		WHERE
			exam.logs.category LIKE CONCAT('%', #{category, jdbcType=VARCHAR}, '%')
	</select>

	<delete id="deleteOldestLog">
		DELETE FROM 
			exam.logs 
		WHERE 
			exam.logs.log_id=(
				SELECT MIN 
					( log_id ) 
				FROM 
					exam.logs 
			);
	</delete>



</mapper>
